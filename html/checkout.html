<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>结算 - 零食小铺</title>
    <link rel="stylesheet" href="../css/style.css">
    <link rel="stylesheet" href="../css/responsive.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <!-- 导航栏 -->
    <header class="header">
        <div class="container">
            <nav class="navbar">
                <a href="../index.html" class="logo">
                    <i class="fas fa-cookie-bite"></i>
                    <span>零食小铺</span>
                </a>
                
                <ul class="nav-menu">
                    <li><a href="../index.html"><i class="fas fa-home"></i> 首页</a></li>
                    <li><a href="products.html"><i class="fas fa-store"></i> 商品</a></li>
                    <li><a href="cart.html"><i class="fas fa-shopping-cart"></i> 购物车 <span id="cart-count">0</span></a></li>
                    <li><a href="profile.html"><i class="fas fa-user"></i> 个人中心</a></li>
                    <li><a href="login.html" id="login-link"><i class="fas fa-sign-in-alt"></i> 登录/注册</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- 结算步骤指示器 -->
    <section class="checkout-steps">
        <div class="container">
            <div class="steps">
                <div class="step active">
                    <span class="step-number">1</span>
                    <span class="step-text">购物车</span>
                </div>
                <div class="step active">
                    <span class="step-number">2</span>
                    <span class="step-text">填写信息</span>
                </div>
                <div class="step">
                    <span class="step-number">3</span>
                    <span class="step-text">确认订单</span>
                </div>
                <div class="step">
                    <span class="step-number">4</span>
                    <span class="step-text">完成支付</span>
                </div>
            </div>
        </div>
    </section>

    <!-- 结算表单 -->
    <main class="main-content checkout-container">
        <div class="container">
            <div class="checkout-form">
                <h2 class="form-title">收货信息</h2>
                <form id="checkout-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="name">收货人姓名 *</label>
                            <input type="text" id="name" required>
                        </div>
                        <div class="form-group">
                            <label for="phone">手机号码 *</label>
                            <input type="tel" id="phone" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="address">收货地址 *</label>
                        <input type="text" id="address" placeholder="省市区街道门牌号" required>
                    </div>
                    
                    <div class="form-group">
                        <label for="note">备注</label>
                        <textarea id="note" rows="3" placeholder="选填，可以告诉我们您的特殊要求"></textarea>
                    </div>
                    
                    <h3 class="section-title">支付方式</h3>
                    <div class="payment-methods">
                        <label class="payment-method">
                            <input type="radio" name="payment" value="alipay" checked>
                            <i class="fab fa-alipay"></i> 支付宝
                        </label>
                        <label class="payment-method">
                            <input type="radio" name="payment" value="wechat">
                            <i class="fab fa-weixin"></i> 微信支付
                        </label>
                    </div>
                    
                    <div class="form-actions">
                        <button type="button" class="btn btn-secondary" onclick="window.history.back()">返回修改</button>
                        <button type="submit" class="btn btn-large">提交订单</button>
                    </div>
                </form>
            </div>
            
            <div class="order-summary">
                <h3>订单详情</h3>
                <div id="order-items">
                    <!-- 订单商品将通过JavaScript加载 -->
                </div>
                <div class="summary-details">
                    <div class="summary-row">
                        <span>商品总价</span>
                        <span id="order-subtotal">¥0.00</span>
                    </div>
                    <div class="summary-row">
                        <span>运费</span>
                        <span>¥0.00</span>
                    </div>
                    <div class="summary-row total">
                        <span>应付总额</span>
                        <span id="order-total">¥0.00</span>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- 页脚 -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>关于零食小铺</h3>
                    <p>我们致力于为您提供最新鲜、最美味、最健康的零食选择。</p>
                </div>
                <div class="footer-section">
                    <h3>联系我们</h3>
                    <p>学号: 25216950228</p>
                    <p>姓名: 陈稣伟</p>
                </div>
                <div class="footer-section">
                    <h3>关注我们</h3>
                    <div class="social-links">
                        <a href="#"><i class="fab fa-weixin"></i></a>
                        <a href="#"><i class="fab fa-weibo"></i></a>
                        <a href="#"><i class="fab fa-qq"></i></a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2023 零食小铺 版权所有</p>
            </div>
        </div>
    </footer>

    <script src="../js/main.js"></script>
    <script>
        // 检查用户登录状态
        checkLoginStatus();
        
        // 结算页面功能
        document.addEventListener('DOMContentLoaded', function() {
            // 加载订单商品
            loadOrderItems();
            
            // 表单提交
            document.getElementById('checkout-form').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // 获取表单数据
                const name = document.getElementById('name').value;
                const phone = document.getElementById('phone').value;
                const address = document.getElementById('address').value;
                const payment = document.querySelector('input[name="payment"]:checked').value;
                
                if (!name || !phone || !address) {
                    alert('请填写所有必填字段');
                    return;
                }
                
                // 模拟订单提交
                alert('订单提交成功！\n订单号：SN' + Date.now());
                
                // 清空购物车
                localStorage.removeItem('snackCart');
                
                // 跳转到首页
                setTimeout(() => {
                    window.location.href = '../index.html';
                }, 1500);
            });
        });
        
        function loadOrderItems() {
            const cart = JSON.parse(localStorage.getItem('snackCart')) || [];
            const orderItemsContainer = document.getElementById('order-items');
            
            if (cart.length === 0) {
                orderItemsContainer.innerHTML = '<p class="empty-order">购物车为空</p>';
                return;
            }
            
            let html = '';
            let subtotal = 0;
            
            cart.forEach(item => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;
                
                html += `
                    <div class="order-item">
                        <div class="order-item-info">
                            <span class="order-item-name">${item.name} × ${item.quantity}</span>
                            <span class="order-item-price">¥${itemTotal.toFixed(2)}</span>
                        </div>
                    </div>
                `;
            });
            
            orderItemsContainer.innerHTML = html;
            
            // 更新价格
            document.getElementById('order-subtotal').textContent = '¥' + subtotal.toFixed(2);
            document.getElementById('order-total').textContent = '¥' + subtotal.toFixed(2);
        }
    </script>
</body>
</html>